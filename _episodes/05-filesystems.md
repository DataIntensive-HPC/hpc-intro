---
layout: episode
title: "File systems and file transfer"
teaching: 10
exercises: 0
questions:
  - "What is the difference between the AFS and Lustre file systems?"
  - "How can I transfer large amount of data to/from PDC?"
objectives:
  - "Learn to navigate the file systems at PDC"
  - "Learn to transfer files to/from PDC"
keypoints:
  - "K1"
  - "K2"
---

# File systems at PDC

When working on a PDC cluster, you will be interacting with two different file systems. 
The differing properties of the two systems are important to understand in order make the most out 
of PDC's resources.

## Andrew File System - AFS

- AFS is a (globally) distributed file system accessible to any running AFS client.
- Your main home directory is on AFS: `/afs/pdc.kth.se/home/<initial>/>username>`
- Access to your AFS home directory is enabled by your Kerberos ticket, and the *AFS token* generated by it.

## Lustre file system (klemming)

- Nicknamed *klemming* at PDC.
- Lustre is an open-source massively parallel distributed file system.
- Very high performance (5PB storage - 130GB/s bandwidth).
- PDC users have two klemming directories:
  - `/cfs/klemming/nobackup/<initial>/<username>`: used for running jobs, input, output...
  - `/cfs/klemming/scratch/<initial>/<username>`: used for temporary files (old files get deleted).
- High file access speed, but performance deteriorates for many (~10<sup>5</sup>) small files.

## Differences between AFS and Lustre

- AFS home directories are backed up every day (lost files can be retrieved!) - Lustre is not backed up.
- AFS is *not accessible* to compute nodes on Beskow. All jobs must run on Lustre.
- AFS has limited usage quota, typically 5 GB per user - no quota is enforced on Lustre.
- Lustre is a high-performance file system - AFS is slow.
- Lustre supports standard (POSIX) Access Control Lists (ACLs) - AFS has own implementation of ACLs.

> ## Exploring your AFS directory
>
> If you haven't already done so, log in to Tegner:
> ```
> $ ssh <username>@tegner.pdc.kth.se
> ```
> {: .bash}
> After logging in, check your current location:
> ```
> $ pwd
> ```
> {: .bash}
> This is your AFS home directory, which is also stored in the `HOME` 
> environment variable:
> ```
> $ echo $HOME
> /afs/pdc.kth.se/home/<initial>/<username>
> ```
> {: .bash}
> You can check your disk quota and how much of it you're using
> with the following command:
> ```
> $ fs listquota
> # or the shortcut: 
> $ fs lq
> ```
> {: .bash}
> This is an example of a `fs` subcommand. To see all 
> available subcommands, type
> ```
> $ fs help
> ```
> {: .bash}
> **Which command can you use to list the access control lists (ACLs)?**
> 
> You also have two "special" directories already set up in your AFS 
> home directory: `Public` is a publicly readable directory and is useful 
> for sharing files with collaborators, and `Private` is a non-readable, 
> non-listable directory for your secrets.   
> **Use the command you found for listing access control lists to compare
> the ACLs in `$HOME`, `$HOME/Public` and `$HOME/Private`.**
{: .challenge}


> ## Your AFS backups
> 
> If you accidentally remove a file from your AFS home, you can 
> retrieve it from yesterday's backup in:
> `$HOME/.OldFiles`   
> If it's been longer than a day since you accidentally removed the file, 
> it might still be retrievable, just contact PDC support!
{: .callout}

> ## Exploring your Lustre directories
>
> You can go to your directories on the Lustre file system by
> ```
> $ cd /cfs/klemming/nobackup/<initial>/<username>
> ```
> {: .bash}
> and
> ```
> $ cd /cfs/klemming/scratch/<initial>/<username>
> ```
> {: .bash}
> To see how many files you have and how much disk space they use, type 
> ```
> $ lfs quota -u $USER /cfs/klemming
> ```
> {: .bash}
> (note the use of the environment variable `$USER`, which is your username)  
{: .challenge}

## Access control lists

- AFS has its own implementation of ACLs, where users can define new groups 
  - set on directory level
- Lustre supports standard (POSIX) ACLs
  - set on file level

**For AFS**, the possible permissions are listed in the table below.

|Notation|File action| Description                      |
| ------ | --------- | -------------------------------- |
|r	 | read      | read the files in the directory  |
|l	 | list      | list the files in the directory  |
|i	 | insert    | create new files                 |
|d	 | delete    | delete files                     |
|w	 | write     | modify files                     |
|k	 | lock	     | lock files in the directory      |
|a	 | administer|change the ACL for the directory  |

**For Lustre**, the POSIX file system permission model defines
three classes of users called `owner`, `group`, and `other`,
and the possible permissions are read (`r`), write (`w`), and execute (`x`).

> ## Creating and managing AFS groups
>
> To alter the ACLs of a directory in your AFS home, use the command 
> `$ fs sa <directory> <user rights>` (where `sa` is short for `setacl`)
> ```
> $ 
> ```
> {: .bash}
> ```
> $ ssh <username>@tegner.pdc.kth.se
> ```
> {: .bash}
> 
>
>
{: .challenge}


